resources:
  jobs:
    Vector_Embeddings:
      name: Vector Embeddings Generator
      description: |
        Generates embeddings for all OpenAlex works using OpenAI text-embedding-3-small.
        Processes ~217M works with abstracts. Estimated ~8-10 days at full throughput.
        Uses ai_query via SQL warehouse to respect OpenAI rate limits.
      email_notifications:
        on_failure:
          - jason@ourresearch.org
        no_alert_for_skipped_runs: true
      max_concurrent_runs: 1
      tasks:
        - task_key: generate_embeddings
          notebook_task:
            notebook_path: /Workspace/Shared/openalex-walden/notebooks/vector_search/BatchEmbeddings
            source: WORKSPACE
          job_cluster_key: embedding-cluster
          timeout_seconds: 864000  # 10 days
      job_clusters:
        - job_cluster_key: embedding-cluster
          new_cluster:
            cluster_name: ""
            spark_version: 15.4.x-scala2.12
            aws_attributes:
              first_on_demand: 1
              availability: ON_DEMAND
              zone_id: auto
            node_type_id: m5.xlarge
            num_workers: 0
            spark_conf:
              spark.databricks.cluster.profile: singleNode
              spark.master: "local[*]"
            custom_tags:
              ResourceClass: SingleNode
            spark_env_vars:
              PYSPARK_PYTHON: /databricks/python3/bin/python3
            data_security_mode: SINGLE_USER
            runtime_engine: STANDARD
      git_source:
        git_url: https://github.com/ourresearch/openalex-walden.git
        git_provider: gitHub
        git_branch: main
      queue:
        enabled: true
